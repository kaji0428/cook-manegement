<!DOCTYPE html>
<html lang="ja" xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout}">

<head>
  <title>ãƒ¬ã‚·ãƒ”ç™»éŒ²</title>
  <link rel="stylesheet" th:href="@{/css/allstyle.css}">
  <link rel="stylesheet" th:href="@{/css/recipe-form.css}">
</head>

<body>
<div th:replace="~{layout :: header}"></div>

<section layout:fragment="content">
  <h2>ãƒ¬ã‚·ãƒ”ãƒ•ã‚©ãƒ¼ãƒ </h2>

  <form  id="recipe-form" th:action="@{/recipes/update}" th:object="${recipeForm}" method="post" enctype="multipart/form-data">

    <!-- ç·¨é›†æ™‚ã«IDã‚’hiddenã§æ¸¡ã™ -->
    <input type="hidden" name="recipeId" th:if="${recipeId != null}" th:value="${recipeId}">

    <!-- æ–™ç†å -->
    <label for="title">æ–™ç†åï¼š</label>
    <input type="text" id="title" th:field="*{title}" required>

    <!-- ã‚­ãƒ£ãƒƒãƒã‚³ãƒ”ãƒ¼ -->
    <label for="shortDescription">ã‚­ãƒ£ãƒƒãƒã‚³ãƒ”ãƒ¼ï¼š</label>
    <input type="text" id="shortDescription" th:field="*{shortDescription}">

    <!-- èª¬æ˜ -->
    <label for="description">èª¬æ˜ï¼š</label>
    <textarea id="description" th:field="*{description}"></textarea>

    <!-- ææ–™ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
    <div class="ingredient-header">
      <label class="ingredient-label">ææ–™ï¼š</label>
      <div class="ingredient-button-wrapper">
        <button type="button" onclick="addIngredient()" class="add-ingredient-button">ï¼‹ ææ–™ã‚’è¿½åŠ </button>
      </div>
      <div class="ingredient-spacer"></div>
    </div>

    <div class="ingredient-header">
      <div class="ingredient-name-label">ææ–™å</div>
      <div id="amount" class="ingredient-quantity-label">åˆ†é‡</div>
    </div>

    <div id="ingredient-container">
      <div th:each="ingredient, iterStat : *{ingredients}" class="ingredient-row">
        <input type="text" th:field="*{ingredients[__${iterStat.index}__].name}" placeholder="ææ–™å" class="ingredient-name" />
        <input type="text" th:field="*{ingredients[__${iterStat.index}__].quantity}" placeholder="åˆ†é‡" class="ingredient-quantity" />
        <button type="button" style="margin: 0px;" class="remove-button" onclick="removeIngredient(this)">âœ•</button>
      </div>
    </div>

    <!-- ç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ -->
    <label for="imageFile">ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«ï¼š</label>
    <input type="file" id="imageFile" name="imageFile">

    <!-- ç·¨é›†æ™‚ï¼šå…ƒã®ç”»åƒãƒ‘ã‚¹ -->
    <input type="hidden" name="originalImagePath" th:value="${recipeForm.imagePath}">

    <!-- ç™»éŒ² or æ›´æ–° -->
    <button  type="submit" th:text="${recipeId != null ? 'æ›´æ–°ã™ã‚‹' : 'ç™»éŒ²ã™ã‚‹'}">ç™»éŒ²ã™ã‚‹</button>

  </form>
</section>

<div th:replace="~{layout :: footer}"></div>

<!-- ğŸ”½ layout.html ã® <div layout:fragment="scripts"> ã«å·®ã—è¾¼ã¾ã‚Œã‚‹ -->
<div layout:fragment="scripts">
  <script th:inline="javascript">
    let ingredientIndex = /*[[${#lists.size(recipeForm.ingredients) ?: 0}]]*/ 0;

    function addIngredient() {
      const container = document.getElementById("ingredient-container");
      const div = document.createElement("div");
      div.className = "ingredient-row";
      div.innerHTML = `
        <input type="text" name="ingredients[${ingredientIndex}].name" placeholder="ææ–™å" class="ingredient-name" />
        <input type="text" name="ingredients[${ingredientIndex}].quantity" placeholder="åˆ†é‡" class="ingredient-quantity" />
        <button type="button" style="margin: 0px" class="remove-button" onclick="removeIngredient(this)">âœ•</button>
      `;
      container.prepend(div);
      ingredientIndex++;
    }

    function removeIngredient(button) {
      button.parentElement.remove();
    }
  </script>
</div>

</body>
</html>
